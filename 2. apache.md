# apache HTTP Server
он будет разобран детально, так как система очень массовая, очень гибкая, от того уязвимостей в ней много и часть из них абсолютно непринимы при различных обстоятельствах.
## распространненность и иная общедоступная информация
кроссплатформенное свободно распространяемый веб-сервер.   
С апреля 1996 и до настоящего времени является самым популярным HTTP-сервером в Интернете.  
язык: C  
дата создания: 1995  
ирония: назывался в шутку «в заплатках», так как закрывал заплатками ошибки NCSA, а теперь сам весь в заплатках.  
конфигурация: текстовые *.conf файлы (httpd.conf - по умолчанию, extra/httpd-vhosts.conf - для виртуальных хостов)  


## "детские" проблемы
* запуск от УЗ с избыточными привилегиями
* включенный модуль выполнения php без нужды
* возможность загружать файлы без проверок
* ошибка конфигурации и возможность использовать ../../ в URL
* ошибки в backend сайтов, которые находятся на веб-сервере.


## определения наличия на узле
### сетевой
если доступ к узлу только сетевой и сканнер является удаленным:  
nmap, скорее всего нас будут интересовать толко порты 80 и 443, но хорошо также 8080 (-p80,443,8080). (хотя -p- тоже прекрасно, если один из сервисов http)  
в возвращаемых дынных будет заголовок http-server-header Apache/*   
также можно воспользоваться скриптом для nmap http-apache-server-status  
что нам важно вытащить из этой информации: версию Apache  
также неплохо понять что за операционная система перед нами (так как сервер явялется кросс платформенным), осмотрев хост по всем портам (-p-), по всем доступным портам общим сканом (-A)  


### если есть edr или шелл на хост
значит у нас фактически есть данные какая ОС на хосте  
для Debian/Ubuntu Linux необходимо выполнить команду apache2 -v  
CentOS/RHEL/Fedora Linux server: httpd -v  
для Windows необходимо найти httpd.exe (если он не прописан в PATH) и использовать команду ":\[Apache directories]\bin\httpd.exe" -v  
собственно отзыв по команде и сравнение версий с реальностью нам даст информацию о факте установки.  
также необходимо проверить факт запуска приложения: sudo ss -ltnup | grep "apache"  

## получив версию 
получив версию мы понимаем какие уязвимости вообще применимы.  
то есть, если у нас установлен Apache 2.4.50, в котором исправлены уязвимости: CVE-2021-41524 и CVE-2021-41773, проверить их, конечно, можно, но вероятность крайне мала, тоже касается уязвимостей в более ранних версиях.

## работа с известными уязвимостями
все уязвимости можно разделить на несколько категорий
* работа с путем внутри, например:
    CVE-2021-41773, закрытая 2.4.49 в связке с миссконфигом, которые давали читать ../../../../etc/passwd и выполнять код  
    для проверки нужно знать:
    + версия ПО
    + параметр конфигов, определяющий возможности использования alias-ов
* работа с файлами, определенного расширения, лежащими внутри сайта, например:
    CVE-2021-44790, закрыта 2.4.51, при обращении к lua-файлу с правильными заголовками можно "положить" веб-сервер  
    для проверки нужно знать:
    + версию ПО
    + файловую структуру внутри веб сервера
    + параметр конфига можно ли загружать файлы на веб-сервер из веба (или параметры бэкэнда)
    + блэклистинг расширений файлов в конфиге, котырые отображаются на сайте
* общеизвестные проблемы бэкенда, по типу SQL инъекций, LFE, RFE

# итого
## модель данных для Apache
* конфиг с разделением с каждым виртуальным сайтом
* версия
* дерево файлов и папок
* cwd
* если нужен респонз, то ID приложений веб-сервера
* запускается ли включении хоста и чем
* под какой УЗ
* запущено сейчас
* установленные расширения поверх (их имя, версия, если висят на другом порту, то каком и в какую сеть)

## архитектура проверки
* обнаружение узла 
* обнаружение ПО на узле
* сбор информации о ПО
* сбор статуса: запущено, куда смотрит
* проверка версии, если на существующую версию есть уязвимости  
    результат: отображение применимых в теории уязвимостей
* проверка конфигов и модели на применимость уязвимостей  
    результат: повышение уровня важности подошедших уязвимостей из первого списка
* запуск скриптов PenTest для фактической проверки, на подходящие уязвимости  
    результат: при успешном прохождении теста на проникновение, максмальное повышение значимости уязвимости из первого списка.
* (опционально) запуск скриптов PenTest, для всех версий Apache 
    результат: вера в разработчиков, старые закрытые CVE все еще закрытые

## требования к 